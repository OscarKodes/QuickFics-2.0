<%- include ../partials/header %>

<!-- Navigation buttons -->
<div class="bg-info d-flex flex-row text-center shadow">
  <div class="w-100">
    <% if (ep_num > 1) { %>
      <% let prevEp = ep_num - 1; %>
      <a class="btn btn-info py-3 w-100 rounded-0" href="/fics/<%= fic._id %>/eps/<%= prevEp %>">
        <i class="fas fa-arrow-left mr-2"></i>Previous Episode
      </a>
    <% } %>
  </div>
  <div class="w-100">
    <a class="btn btn-secondary py-3 w-100 rounded-0" href="/fics/<%= fic._id %>/">Back to Fic Page</a>
  </div>
  <div class="w-100">
    <% if (ep_num < last_ep_num) { %>
      <% let nextEp = ep_num + 1; %>
      <a class="btn btn-info py-3 w-100 rounded-0" href="/fics/<%= fic._id %>/eps/<%= nextEp %>">
        Next Episode<i class="fas fa-arrow-right ml-2"></i>
      </a>
    <% } %>
  </div>
</div>

<!-- Like Button -->
<div class="text-center">
  <form class="" action="/fics/<%=fic._id%>/eps/<%=ep_num%>/like?_method=PUT" method="post">
    <button class="btn btn-light shadow my-4" type="submit" name="button">
      <% if (currentUser && ep.likes.includes(currentUser._id)) { %>
        <i class="fas fa-star mr-2 text-warning"></i>Star Given!</button>
      <% } else { %>
        <i class="fas fa-star mr-2"></i>Give a Star</button>
      <% } %>
  </form>
</div>

  <!-- EPISODE TITLE -->
  <div class="text-center bg-white shadow mt-4 mx-4 py-3 rounded ep-show-header">
    <!-- EDIT BTN -->
    <div class="ep-edit-btn-container">
      <a class="btn btn-outline-primary ep-show-edit-btn border-0"
        href="/fics/<%=fic._id%>/eps/<%=ep_num%>/edit">
        <i class="fas fa-edit pl-1 fa-2x"
          SameSite=None Secure></i>
      </a>
    </div>
    <h2 class="display-4"><%= ep.title %></h2>
  </div>




<!-- EPISODE DIALOGUE -->
  <div id="dialogue-container" class="shadow mx-5">
    <% ep.char.forEach(function(char, i){ %>

      <div class="border-bottom bg-white pt-1 pb-2">
        <!-- Row for Name and Text -->
        <div class="row bg-white">
          <!-- Column for Name -->
          <div class="col-3 text-center">
            <p class="dialogue-name char-name show-page"
              style="color:<%=ep.fontColor[i]%>;
              background-color:<%=ep.highlight[i]%>;">
              <%= char %></p>
          </div>
          <!-- Column for Dialogue Text -->
          <div class="col-9">
            <p class="m-0 border-0 dialogue-text"><%= ep.text[i] %></p>
          </div>
        </div>
      </div>
    <% }) %>
  </div>

  <!-- Like Button -->
  <div class="text-center">
    <form class="" action="/fics/<%=fic._id%>/eps/<%=ep_num%>/like?_method=PUT" method="post">
      <button class="btn btn-light shadow my-4" type="submit" name="button">
        <% if (currentUser && ep.likes.includes(currentUser._id)) { %>
          <i class="fas fa-star mr-2 text-warning"></i>Star Given!</button>
        <% } else { %>
          <i class="fas fa-star mr-2"></i>Give a Star</button>
        <% } %>
    </form>
  </div>

  <!-- Navigation buttons -->
  <div class="bg-info d-flex flex-row text-center shadow">
    <div class="w-100">
      <% if (ep_num > 1) { %>
        <% let prevEp = ep_num - 1; %>
        <a class="btn btn-info py-3 w-100 rounded-0" href="/fics/<%= fic._id %>/eps/<%= prevEp %>">
          <i class="fas fa-arrow-left mr-2"></i>Previous Episode
        </a>
      <% } %>
    </div>
    <div class="w-100">
      <a class="btn btn-secondary py-3 w-100 rounded-0" href="/fics/<%= fic._id %>/">Back to Fic Page</a>
    </div>
    <div class="w-100">
      <% if (ep_num < last_ep_num) { %>
        <% let nextEp = ep_num + 1; %>
        <a class="btn btn-info py-3 w-100 rounded-0" href="/fics/<%= fic._id %>/eps/<%= nextEp %>">
          Next Episode<i class="fas fa-arrow-right ml-2"></i>
        </a>
      <% } %>
    </div>
  </div>


    <!-- invisible bgColor div to pass data form back to front -->
    <div class="d-none">
      <% let currentColor = ep.bgColor ? ep.bgColor : "#fff"; %>
      <input id="ep-bg-color" type="text" name="" value="<%= currentColor %>">
    </div>

<!-- jQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<!-- Script for dynamic bg color -->
<script type="text/javascript">
  const bgColor = $("#ep-bg-color").val();
  $("body").css("background-color", bgColor);
</script>

<%- include ../partials/footer %>
