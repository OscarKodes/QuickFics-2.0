<%- include ../partials/header %>

<!-- Author control panel -->
<% if (currentUser && currentUser._id.equals(fic.author._id)) { %>
  <% let currPage = "ficPage" %>
  <% include ../partials/authorControlPanel %>
<% } %>

  <!-- Fic Heading -->
  <div class="fic-header text-center bg-white shadow-sm pt-2 pb-4">
    <h1 class="display-3 my-4">
      <%= fic.title %>
    </h1>
    <p>
      Author:
      <em>
        <a class="text-decoration-none" href="/user/<%= fic.author._id %>">
          <%=fic.author.name ? fic.author.name : fic.author.username %>
        </a>
      </em>
    </p>
    <p>
      Created:
      <em>
        <%=fic.dateCreated.toString().slice(0, 15) %>
      </em>
    </p>
    <p class="my-4">
      <%= fic.description %>
    </p>

    <!-- Show Fic USER CONTROL PANEL -->
    <div class="user-control-panel shadow-sm">

        <% if (currentUser && currentUser.savedFics.includes(fic._id)) { %>
          <form class="d-inline" action="/savedfics/<%= fic._id %>?_method=DELETE" method="post">
            <button class="user-control-btn saved-fic-btn" type="submit">
              <i class="fas fa-bookmark mr-2"
                SameSite=None Secure></i>Fic Saved!
            </button>
          </form>
        <% } else { %>
          <form class="d-inline" action="/savedFics" method="post">
            <input class="d-none" type="text" name="fic_id" value="<%= fic._id %>">
            <button class="user-control-btn" type="submit">
              <i class="fas fa-bookmark mr-2"
                SameSite=None Secure></i>Save Fic
            </button>
          </form>
        <% } %>

      <a class="user-control-btn"
        href="/fics/<%= fic._id %>/chars">
        <i class="fas fa-users mr-2"
          SameSite=None Secure></i>See Characters
      </a>
      <!-- Copy to Clipboard button -->
      <%- include ../partials/copyToClipBoard %>

    <!-- Closing tag for user control panel -->
    </div>
  <!-- Closing tag for fic heading -->
  </div>

  <!-- Start Reading Button -->
  <div class="text-center mt-4">
    <% if (fic.eps.length > 0) { %>
      <a class="btn btn-primary btn-xl shadow-lg" href="/fics/<%= fic._id %>/eps/1">
        Start Reading
      </a>
    <% } else { %>
      <p>There are currently no episodes for this Fic.</p>
    <% } %>
  </div>


  <div class="text-center bg-light border rounded m-3 shadow-sm overflow-hidden">
    <h2 class="my-4">Episode List</h2>

    <% fic.eps.forEach(function(ep, i){ %>
        <a class="episode-link nav-link bg-light" href="/fics/<%= fic._id %>/eps/<%= i + 1 %>">
          <p class="text-dark">Episode <%= i + 1 %>: <%= ep.title %> <span><%=ep.dateCreated.toString().slice(0, 15)%></span></p>
        </a>
    <% }) %>
  </div>


<%- include ../partials/footer %>
